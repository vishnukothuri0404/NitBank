apiVersion: eksctl.io/v1alpha5
kind: ClusterConfig

metadata:
  name: kube-game-cluster
  region: us-east-1
  version: "1.21"

nodeGroups:
  - name: kube-game-ng
    instanceType: t2.medium
    desiredCapacity: 1
    minSize: 1
    maxSize: 3
    volumeSize: 40
    volumeType: gp2
    ssh:
      allow: true
      publicKeyName: Vishnu_2048
    privateNetworking: false
    overrideBootstrapCommand: |
      #!/bin/bash
      # Install custom packages or software
      yum install ruby wget -y
      wget https://aws-codedeploy-us-east-2.s3.us-east-2.amazonaws.com/latest/install
      chmod +x ./install
      sudo ./install auto
      systemctl start codedeploy-agent
      systemctl enable codedeploy-agent
      
      # Install kubectl
      curl -LO "https://dl.k8s.io/release/$(curl -L -s https://dl.k8s.io/release/stable.txt)/bin/linux/amd64/kubectl"
      sudo install -o root -g root -m 0755 kubectl /usr/local/bin/kubectl
      kubectl version --client

      # Custom IAM Role
      echo "Setting up IAM role and instance profile"
      
      # Now run the default bootstrap process (EKS default script)
      /etc/eks/bootstrap.sh kube-game-cluster
    iam:
      instanceRoleARN: arn:aws:iam::872515248362:role/ec2tofullacess-blue-green
